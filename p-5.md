# Práctica 5 — `struct` + Archivos con Inventario de Insumos Clínicos (caducidad y reorden)

> **Propósito.** Modelar y persistir un **inventario de insumos**: capturar registros, calcular **valor total**, detectar **reorden** y **próxima caducidad**, usando **estructuras**, **arreglos** y **archivos CSV**.

---

## 1) Objetivo general

Diseñar un sistema modular que gestione **insumos clínicos** con `struct`, arreglos y archivos, incorporando funciones de **captura**, **listado**, **búsqueda**, **reorden** y **caducidad**.

---

## 2) Marco teórico (resumen)

### 2.1 `struct` para datos compuestos

```cpp
struct Insumo {
    int id;                 // Identificador único
    std::string nombre;     // Nombre del insumo
    std::string categoria;  // Guantes, Mascarillas, Jeringas, etc.
    int stock;              // Piezas actuales
    int stockMin;           // Punto de reorden
    double costoUnit;       // $ por pieza
    int cadAnio;            // Caducidad (AAAA)
    int cadMes;             // Caducidad (1..12)
};
```

### 2.2 CSV con `<fstream>`

* `ofstream` para escribir, `ifstream` para leer; validar apertura.
* Separar por comas al leer; convertir con `stoi`/`stod`.

### 2.3 Utilidades numéricas

* **Valor de un insumo:** `stock * costoUnit`.
* **Meses a caducar:**
  `meses = (cadAnio*12 + cadMes) - (anioAct*12 + mesAct)`.

---

## 3) Desarrollo (en cada bloque)

1. **Pseudocódigo**
2. **Diagrama (guía)**
3. **Código C++** (fragmento funcional)

---

## 4) Bloques de actividades

### Bloque 1 — Definir `struct` y funciones puras

**Funciones objetivo:**

* `double valorInsumo(int stock, double costoUnit)`
* `int mesesParaCaducar(int cadAnio, int cadMes, int anioAct, int mesAct)`

**Pseudocódigo**

```
FUNC valorInsumo(stock, costo): RETORNAR stock * costo
FUNC mesesParaCaducar(cAnio,cMes,aAnio,aMes):
  RETORNAR (cAnio*12 + cMes) - (aAnio*12 + aMes)
```

**Código C++**

```cpp
#include <iostream>
#include <string>
using namespace std;

struct Insumo {
    int id; string nombre; string categoria;
    int stock, stockMin; double costoUnit;
    int cadAnio, cadMes;
};

double valorInsumo(int stock, double costoUnit){ return stock * costoUnit; }

int mesesParaCaducar(int cadAnio, int cadMes, int anioAct, int mesAct){
    return (cadAnio*12 + cadMes) - (anioAct*12 + mesAct);
}

int main(){
    cout << valorInsumo(120, 3.5) << "\n";             // demo
    cout << mesesParaCaducar(2026, 3, 2025, 11) << "\n"; // demo
    return 0;
}
```

---

### Bloque 2 — Capturar N insumos (con validación básica)

**Pseudocódigo**

```
LEER N
PARA i=0..N-1
  LEER id, nombre, categoria, stock, stockMin, costoUnit, cadAnio, cadMes
  VALIDAR stock>=0, stockMin>=0, costoUnit>0, 1<=cadMes<=12
  GUARDAR en lista[i]
FIN
```

**Código C++**

```cpp
#include <iostream>
#include <limits>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

int main(){
    const int MAX=300; Insumo inv[MAX]; int N;
    cout << "Numero de insumos: "; cin >> N;
    cin.ignore(numeric_limits<streamsize>::max(), '\n');

    for(int i=0;i<N;i++){
        cout << "\nInsumo #" << (i+1) << "\n";
        cout << "ID: "; cin >> inv[i].id; cin.ignore();
        cout << "Nombre: "; getline(cin, inv[i].nombre);
        cout << "Categoria: "; getline(cin, inv[i].categoria);
        cout << "Stock: "; cin >> inv[i].stock;
        cout << "Stock minimo: "; cin >> inv[i].stockMin;
        cout << "Costo unitario: "; cin >> inv[i].costoUnit;
        cout << "Caducidad (AAAA MM): "; cin >> inv[i].cadAnio >> inv[i].cadMes;

        if(inv[i].stock<0 || inv[i].stockMin<0 || inv[i].costoUnit<=0 || inv[i].cadMes<1 || inv[i].cadMes>12){
            cout << "Entrada invalida. Ajuste y repita este registro.\n"; i--;
        }
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
    }
    cout << "\nCaptura completada.\n";
    return 0;
}
```

---

### Bloque 3 — Mostrar tabla con valor total por insumo

**Pseudocódigo**

```
IMPRIMIR encabezados
PARA cada insumo
  valor ← stock * costoUnit
  IMPRIMIR fila formateada
FIN
```

**Código C++**

```cpp
#include <iostream>
#include <iomanip>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

void imprimirTabla(const Insumo a[], int n){
    cout << left
         << setw(6)  << "ID"
         << setw(18) << "NOMBRE"
         << setw(12) << "CATEGORIA"
         << setw(8)  << "STOCK"
         << setw(10) << "MIN"
         << setw(12) << "COSTO"
         << setw(10) << "VALOR"
         << setw(8)  << "CAD(AA/MM)" << "\n";
    cout << string(84,'-') << "\n";
    cout << fixed << setprecision(2);
    for(int i=0;i<n;i++){
        double valor = a[i].stock * a[i].costoUnit;
        cout << left
             << setw(6)  << a[i].id
             << setw(18) << a[i].nombre.substr(0,17)
             << setw(12) << a[i].categoria.substr(0,11)
             << setw(8)  << a[i].stock
             << setw(10) << a[i].stockMin
             << setw(12) << a[i].costoUnit
             << setw(10) << valor
             << setw(2)  << a[i].cadAnio << "/"
             << setw(2)  << a[i].cadMes  << "\n";
    }
}

int main(){
    Insumo demo[3] = {
        {101,"Guantes Nitrilo","Guantes",250,150,1.80,2026, 2},
        {102,"Cubrebocas 3C","Mascarilla", 90,100,0.75,2025,12},
        {103,"Jeringa 5ml","Jeringa",     40, 50,2.10,2026, 6}
    };
    imprimirTabla(demo,3);
    return 0;
}
```

---

### Bloque 4 — Búsqueda por ID

**Pseudocódigo**

```
FUNC buscarPorId(a[],n,id):
  PARA i=0..n-1
    SI a[i].id == id RETORNAR i
  RETORNAR -1
```

**Código C++**

```cpp
#include <iostream>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

int buscarPorId(const Insumo a[], int n, int id){
    for(int i=0;i<n;i++) if(a[i].id==id) return i;
    return -1;
}

int main(){
    Insumo a[2]={{10,"Guantes","Guantes",200,100,1.5,2026,5},{20,"Mascarilla","Mascarilla",50,80,0.7,2025,12}};
    int id; cout << "ID a buscar: "; cin >> id;
    int k = buscarPorId(a,2,id);
    if(k==-1) cout << "No encontrado\n";
    else cout << "Encontrado: " << a[k].nombre << " (stock " << a[k].stock << ")\n";
    return 0;
}
```

---

### Bloque 5 — Guardar CSV

**Formato:** `id,nombre,categoria,stock,stockMin,costoUnit,cadAnio,cadMes`

**Pseudocódigo**

```
ABRIR "insumos.csv"
ESCRIBIR encabezado
PARA cada insumo
  ESCRIBIR campos separados por coma
FIN
CERRAR
```

**Código C++**

```cpp
#include <fstream>
#include <iomanip>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

bool guardarCSV(const string& ruta, const Insumo a[], int n){
    ofstream out(ruta);
    if(!out) return false;
    out << "id,nombre,categoria,stock,stockMin,costoUnit,cadAnio,cadMes\n";
    out << fixed << setprecision(2);
    for(int i=0;i<n;i++){
        out << a[i].id << "," << a[i].nombre << "," << a[i].categoria << ","
            << a[i].stock << "," << a[i].stockMin << ","
            << a[i].costoUnit << "," << a[i].cadAnio << "," << a[i].cadMes << "\n";
    }
    return true;
}
```

---

### Bloque 6 — Cargar CSV

**Pseudocódigo**

```
ABRIR "insumos.csv"
LEER y descartar encabezado
MIENTRAS haya linea
  separar por comas → asignar campos
  convertir a tipos y guardar en arreglo
FIN
RETORNAR cantidad cargada
```

**Código C++**

```cpp
#include <fstream>
#include <sstream>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

int cargarCSV(const string& ruta, Insumo a[], int maxN){
    ifstream in(ruta);
    if(!in) return -1;
    string linea;
    if(!getline(in,linea)) return 0; // encabezado
    int n=0;
    while(getline(in,linea) && n<maxN){
        stringstream ss(linea);
        string sId,sNombre,sCat,sStock,sMin,sCosto,sAnio,sMes;
        if(!getline(ss,sId,',')) continue;
        getline(ss,sNombre,',');
        getline(ss,sCat,',');
        getline(ss,sStock,',');
        getline(ss,sMin,',');
        getline(ss,sCosto,',');
        getline(ss,sAnio,',');
        getline(ss,sMes,',');

        a[n].id       = stoi(sId);
        a[n].nombre   = sNombre;
        a[n].categoria= sCat;
        a[n].stock    = stoi(sStock);
        a[n].stockMin = stoi(sMin);
        a[n].costoUnit= stod(sCosto);
        a[n].cadAnio  = stoi(sAnio);
        a[n].cadMes   = stoi(sMes);
        n++;
    }
    return n;
}
```

---

### Bloque 7 — Alertas: Reorden y Próxima Caducidad

**A) Reorden:** listar insumos con `stock <= stockMin`.
**B) Caducidad:** dados `anioAct` y `mesAct`, listar los que **caducan en ≤ 3 meses**.

**Pseudocódigo**

```
PROC listarReorden(a[],n):
  PARA i=0..n-1 si a[i].stock <= a[i].stockMin -> IMPRIMIR

PROC listarPorCaducidad(a[],n,anioAct,mesAct):
  PARA i=0..n-1
    m ← mesesParaCaducar(a[i].cadAnio,a[i].cadMes,anioAct,mesAct)
    SI m <= 3 ENTONCES IMPRIMIR (m)
```

**Código C++**

```cpp
#include <iostream>
#include <iomanip>
#include <string>
using namespace std;

struct Insumo { int id; string nombre, categoria; int stock, stockMin; double costoUnit; int cadAnio, cadMes; };

int mesesParaCaducar(int cA,int cM,int aA,int aM){ return (cA*12+cM) - (aA*12+aM); }

void listarReorden(const Insumo a[], int n){
    cout << "=== Reorden (stock <= min) ===\n";
    for(int i=0;i<n;i++)
        if(a[i].stock <= a[i].stockMin)
            cout << a[i].id << " - " << a[i].nombre << " (stock " << a[i].stock << ", min " << a[i].stockMin << ")\n";
}

void listarPorCaducidad(const Insumo a[], int n, int anio, int mes){
    cout << "=== Caducidad <= 3 meses ===\n";
    for(int i=0;i<n;i++){
        int m = mesesParaCaducar(a[i].cadAnio,a[i].cadMes,anio,mes);
        if(m <= 3)
            cout << a[i].id << " - " << a[i].nombre << " (cad " << a[i].cadAnio << "/" << a[i].cadMes << ", en " << m << " meses)\n";
    }
}
```

---

## 5) Ejercicio integrador

**“Inventario clínico con persistencia”**

Construir un programa con **menú** (`do-while + switch`) que permita:

1. **Capturar** N insumos.
2. **Listar** tabla con valor por insumo y **valor total** de inventario.
3. **Buscar por ID**.
4. **Guardar CSV** (`insumos.csv`).
5. **Cargar CSV** (reemplaza la lista en memoria).
6. **Alertas**:

   * Reorden (`stock <= stockMin`)
   * Próxima caducidad (≤3 meses; pedir `anioAct` y `mesAct`)
7. **Salir**.

**Requisitos:**

* Usar `struct Insumo` y funciones separadas.
* Validar entradas clave (mes 1..12, costos > 0, stocks ≥ 0).
* Reportar **valor total** (suma de `stock*costoUnit`).

---

## 6) Preguntas de reflexión

1. ¿Qué ventajas tiene modelar con `struct` en lugar de arreglos paralelos?
2. ¿Qué riesgos hay al cargar datos sin validar (mes fuera de 1..12, stock negativo)?
3. ¿Cómo adaptarías el sistema si algunos insumos **no caducan**? (p. ej., usar `cadAnio=0,cadMes=0`).
4. ¿Qué diferencias prácticas hay entre **valor total** y **alerta de reorden**?

---

## 8) Compilación

```bash
g++ -std=c++17 main.cpp -o main
./main
```

(Code::Blocks: F9)

---
